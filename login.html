<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SwarWorld - Login</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
<style>
body { background: linear-gradient(135deg, #2a0845, #6441a5); font-family: 'Poppins', sans-serif; height: 100vh; display: flex; align-items: center; justify-content: center; }
.auth-box { background: #fff; padding: 30px; border-radius: 15px; box-shadow: 0px 8px 25px rgba(0,0,0,0.25); width: 380px; text-align: center; position: relative; }
.auth-box h2 { margin-bottom: 20px; font-weight: bold; color: #2a0845; }
.auth-box input { margin-bottom: 12px; border-radius: 8px; padding-right: 40px; }
.auth-box button { background: #6441a5; border: none; color: #fff; padding: 10px; width: 100%; border-radius: 8px; font-size: 16px; transition: 0.3s; }
.auth-box button:hover { background: #503285; }
.toggle-link { color: #6441a5; cursor: pointer; font-weight: bold; }
.logo { font-size: 26px; font-weight: bold; margin-bottom: 10px; color: #6441a5; }
.logo span { color: #2a0845; }
.password-toggle { position: absolute; right: 15px; top: 50%; transform: translateY(-50%); cursor: pointer; color: #6441a5; }
.position-relative { position: relative; }
</style>
</head>
<body>

<div class="auth-box">
  <div class="logo">ðŸŽ¶ Swar<span>World</span></div>
  <h2 id="formTitle">Login</h2>

  <!-- Login Form -->
  <form id="loginForm">
    <input type="email" id="loginEmail" class="form-control" placeholder="Email" required>
    <div class="position-relative">
      <input type="password" id="loginPassword" class="form-control" placeholder="Password" required>
      <i class="bi bi-eye-slash password-toggle" onclick="togglePassword('loginPassword', this)"></i>
    </div>
    <button type="submit">Login</button>
    <p class="mt-2">Don't have an account? <span class="toggle-link" onclick="showSignup()">Sign Up</span></p>
  </form>

  <!-- Signup Form -->
  <form id="signupForm" style="display:none;">
    <input type="email" id="signupEmail" class="form-control" placeholder="Email" required>
    <div class="position-relative">
      <input type="password" id="signupPassword" class="form-control" placeholder="Password" required>
      <i class="bi bi-eye-slash password-toggle" onclick="togglePassword('signupPassword', this)"></i>
    </div>
    <button type="submit">Sign Up</button>
    <p class="mt-2">Already have an account? <span class="toggle-link" onclick="showLogin()">Login</span></p>
  </form>

  <!-- OTP Form -->
  <form id="otpForm" style="display:none;">
    <input type="text" id="otpInput" class="form-control" placeholder="Enter OTP" required>
    <button type="submit">Verify OTP</button>
    <p class="mt-2" id="otpMsg"></p>
  </form>
</div>

<script>
function togglePassword(inputId, icon){
  const input=document.getElementById(inputId);
  input.type = input.type==='password'?'text':'password';
  icon.classList.toggle('bi-eye');
  icon.classList.toggle('bi-eye-slash');
}

function showSignup(){ 
  document.getElementById("signupForm").style.display="block"; 
  document.getElementById("loginForm").style.display="none"; 
  document.getElementById("otpForm").style.display="none"; 
  document.getElementById("formTitle").innerText="Sign Up"; 
}
function showLogin(){ 
  document.getElementById("loginForm").style.display="block"; 
  document.getElementById("signupForm").style.display="none"; 
  document.getElementById("otpForm").style.display="none"; 
  document.getElementById("formTitle").innerText="Login"; 
}

// Signup
document.getElementById("signupForm").addEventListener("submit", async function(e){
  e.preventDefault();
  const email=document.getElementById("signupEmail").value.toLowerCase();
  const pass=document.getElementById("signupPassword").value;
  if(email==="admin@gmail.com"){ alert("Cannot signup as Admin!"); return; }

  // Send OTP
  const res=await fetch('http://localhost:3000/send-otp',{
    method:'POST', 
    headers:{'Content-Type':'application/json'}, 
    body: JSON.stringify({email})
  });
  const data=await res.json();
  if(data.success){
    document.getElementById("signupForm").style.display="none";
    document.getElementById("otpForm").style.display="block";
    document.getElementById("otpMsg").innerText=`OTP sent to ${email}`;
    window.currentUser={email, pass};
  } else { alert("Error sending OTP."); }
});

// Login
document.getElementById("loginForm").addEventListener("submit", async function(e){
  e.preventDefault();
  const email=document.getElementById("loginEmail").value.toLowerCase();
  const pass=document.getElementById("loginPassword").value;

  const res=await fetch('http://localhost:3000/login',{
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body: JSON.stringify({email, pass})
  });
  const data=await res.json();

  if(data.success){
    if(data.isAdmin){
      localStorage.setItem("adminLoggedIn","true");
      alert("Welcome Admin!");
      window.location.href="admin.html";
    } else {
      localStorage.setItem("loggedIn","true");
      alert("Login successful!");
      window.location.href="instrument.html";
    }
  } else { 
    alert(data.message); 
  }
});

// Verify OTP
document.getElementById("otpForm").addEventListener("submit", async function(e){
  e.preventDefault();
  const otp=document.getElementById("otpInput").value;
  const res=await fetch('http://localhost:3000/verify-otp',{
    method:'POST', 
    headers:{'Content-Type':'application/json'}, 
    body: JSON.stringify({ email: window.currentUser.email, otp, pass: window.currentUser.pass })
  });
  const data=await res.json();
  if(data.verified){
    localStorage.setItem("loggedIn","true");
    alert("Signup successful! You can now login.");
    showLogin();
  } else { 
    alert("Invalid OTP. Try again."); 
  }
});
</script>
</body>
</html>
