<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SwarWorld - Admin Dashboard</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
<style>
  body { font-family: 'Poppins', sans-serif; background: #f4f4f9; margin: 0; }
  header { background: #6441a5; color: #fff; padding: 20px; text-align: center; font-size: 24px; font-weight: bold; }
  nav { background: #2a0845; padding: 10px 0; }
  nav ul { list-style: none; display: flex; justify-content: center; margin: 0; padding: 0; }
  nav ul li { margin: 0 20px; }
  nav ul li a { color: #fff; text-decoration: none; font-weight: bold; font-size: 16px; }
  nav ul li a.logout { color: #e74c3c; }
  main { padding: 20px; max-width: 1200px; margin: auto; }
  section { margin-bottom: 50px; }
  section h2 { color: #2a0845; margin-bottom: 15px; font-weight: bold; border-bottom: 2px solid #6441a5; padding-bottom: 5px; }
  table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
  th, td { border: 1px solid #ddd; padding: 10px; text-align: center; }
  th { background: #6441a5; color: #fff; }
  tr:nth-child(even) { background: #f9f9f9; }
  button { border: none; padding: 6px 12px; border-radius: 5px; cursor: pointer; font-weight: bold; }
  .btn-delete { background: #e74c3c; color: #fff; }
  .btn-active { background: #27ae60; color: #fff; }
  .btn-pending { background: #f39c12; color: #fff; }
  .btn-resolved { background: #3498db; color: #fff; }
  .form-control { margin-bottom: 10px; }
  footer { text-align: center; padding: 15px; color: #777; font-size: 14px; }
</style>
</head>
<body>

<header>ðŸŽ¶ SwarWorld Admin Dashboard</header>

<nav>
  <ul>
    <li><a href="#users">Users</a></li>
    <li><a href="#reports">Reports</a></li>
    <li><a href="#settings">Settings</a></li>
    <li><a href="#" class="logout" onclick="logoutAdmin()">Logout</a></li>
  </ul>
</nav>

<main>
  <!-- Users -->
  <section id="users">
    <h2>Registered Users</h2>
    <table>
      <thead>
        <tr>
          <th>User ID</th>
          <th>Email</th>
          <th>Status</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody id="userTable"></tbody>
    </table>
  </section>

  <!-- Reports -->
  <section id="reports">
    <h2>Reports / Critical Info</h2>
    <table>
      <thead>
        <tr>
          <th>Report ID</th>
          <th>User</th>
          <th>Issue</th>
          <th>Status</th>
          <th>Date</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody id="reportTable"></tbody>
    </table>
  </section>

  <!-- Settings -->
  <section id="settings">
    <h2>Admin Settings</h2>
    <form id="changePasswordForm">
      <input type="password" id="newPassword" class="form-control" placeholder="New Password" required>
      <button type="submit" class="btn btn-active">Update Password</button>
    </form>
  </section>
</main>

<footer>&copy; 2025 SwarWorld | Admin Panel</footer>

<!-- Firebase -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getDatabase, ref, onValue, update, remove } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

// Firebase config
const firebaseConfig = {
  apiKey: "YOUR_API_KEY",
  authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
  databaseURL: "https://YOUR_PROJECT_ID-default-rtdb.firebaseio.com",
  projectId: "YOUR_PROJECT_ID",
  storageBucket: "YOUR_PROJECT_ID.appspot.com",
  messagingSenderId: "YOUR_SENDER_ID",
  appId: "YOUR_APP_ID"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

const userTable = document.getElementById("userTable");
const reportTable = document.getElementById("reportTable");

// Admin login check
if(localStorage.getItem("adminLoggedIn") !== "true") {
  alert("Unauthorized! Admin only.");
  window.location.href = "login.html";
}

// Fetch users dynamically
function fetchUsers() {
  const usersRef = ref(db, 'users');
  onValue(usersRef, (snapshot) => {
    userTable.innerHTML = '';
    if(snapshot.exists()){
      snapshot.forEach((userSnap)=>{
        const data = userSnap.val();
        const statusBtn = `<button class="${data.status === 'Active' ? 'btn-active' : 'btn-pending'}" onclick="toggleUserStatus('${userSnap.key}')">${data.status}</button>`;
        const row = `<tr>
          <td>${userSnap.key}</td>
          <td>${data.email}</td>
          <td>${statusBtn}</td>
          <td><button class="btn-delete" onclick="deleteUser('${userSnap.key}')">Delete</button></td>
        </tr>`;
        userTable.innerHTML += row;
      });
    } else {
      userTable.innerHTML = "<tr><td colspan='4'>No Users Found</td></tr>";
    }
  });
}

// Toggle user status
window.toggleUserStatus = function(id) {
  const userRef = ref(db, `users/${id}`);
  update(userRef, {status: (userRef.status === 'Active' ? 'Pending' : 'Active')});
}

// Delete user
window.deleteUser = function(id){
  if(confirm("Delete this user?")){
    remove(ref(db, `users/${id}`));
  }
}

// Logout
function logoutAdmin(){
  localStorage.removeItem("adminLoggedIn");
  window.location.href = "login.html";
}

// Change admin password (demo)
document.getElementById("changePasswordForm").addEventListener("submit", e=>{
  e.preventDefault();
  const pwd = document.getElementById("newPassword").value;
  alert(`Admin password updated to "${pwd}" (Demo only, implement backend to store securely).`);
});

// Auto-fetch data
window.onload = ()=>{ fetchUsers(); }
</script>
</body>
</html>
